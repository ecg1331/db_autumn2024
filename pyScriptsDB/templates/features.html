<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HP Coffee Queries</title>
    <!-- Bootstrap CSS (from CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons CSS (from CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    
    <style>
        h1 {
            font-size: 2.5rem;  /* Larger font size for impact */
            font-weight: 700;
            color:#393E41;  /* Darker color for good contrast */
            text-align: center;
            padding-left: 30px;  /* Add extra padding to the left for text inside */
            padding-right: 30px; /* Add extra padding to the right for text inside */
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 20px 0;
            background-color:#f7f7f4; /* Subtle white background */
            border-radius: 5px;  /* Rounded corners for the background */
            margin-bottom: 40px; /* Adds space below the title */
            border-color: #d9593a;
            border: 0px solid #d9593a;

        }

        .modal-content {
            background-color: #f7f7f4; /* Light gray background */
            border-radius: 8px;
            color:#393E41;
        }
    
        .modal-header {
            background-color: #f7f7f7; 
            display: flex; /* Enable flexbox */
            justify-content: space-between; /* Space between title and icon */
            align-items: center; /* Align vertically */
            border-color: #e78f79;
            font-weight: bold;
            color:#393E41;
        
        }
    
        .custom-list-group {
            background-color: #f7f7f4; 
            color: #393E41;
        }

        .h1 {
            font-weight: bold;
            color:#393E41;
        }
        .custom-list-group .list-group-item:hover {
            background-color: #dededc; 
            color: #393E41;
        }

        /* Change the modal footer background color */
        .modal-footer {
            background-color: #f7f7f7; /* Light gray footer */
            border-color: #e78f79;

        }
    
        /* Change the modal overlay (background color when modal is open) */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7); /* Darker backdrop */
        }
    
        .modal-border {
            color: #e06f52
        }
    
        .btn-primary {
            background-color: #dc5f3f; /* Custom color for primary button */
            border: none;
        }
    
        .btn-primary:hover {
            background-color: #c65639; /* Darker shade on hover */
        }
        
        .feature-card {
            display: flex;
            border: 1.8px solid #d9593a;
            flex-direction: column;
            justify-content: space-between;        
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: #393E41;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-height: 250px; /* Set the minimum height, adjust as needed */
        }
        
        .d-flex {
            display: flex;
        }
        
        .flex-grow-1 {
            flex-grow: 1;
        }
        
        
        .feature-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .feature-card-icon {
            font-size: 3rem;
            color: #d9593a;  /* Change this to your desired hex color */
        }

        .feature-card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 15px;
            color:#393E41;
        }
        

        .feature-card-description {
            margin-top: 10px;
            font-size: 1rem;
            flex-grow: 1;
            color: #393E41;
        }

        .feature-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
            color: #393E41;
        }

        /* Ensure responsiveness */
        .feature-card-container .col-md-4 {
            flex: 1 0 30%; /* 3 items per row on medium screens */
            min-width: 250px; /* Ensures the cards shrink on smaller screens */
        }

        @media (max-width: 768px) {
            .feature-card-container .col-md-4 {
                flex: 1 0 45%; /* 2 items per row on smaller screens */
            }
        }

        @media (max-width: 480px) {
            .feature-card-container .col-md-4 {
                flex: 1 0 100%; /* 1 item per row on extra small screens */
            }
        }

        #queryModalLabel {
            margin-right: 10px; /* Adds space between title and icon */
            font-weight: bold;
            color: #393E41;
            
        }

        #yearInputModalLabel {
            margin-right: 10px; /* Adds space between title and icon */
            font-weight: bold;
            color: #393E41;
            
        }

        .modal-icon {
            width: 30px; /* Size of the icon container */
            height: 30px; /* Size of the icon container */
            background-color: #d9593a; /* Background color of the icon */
            color: #f7f7f4; /* Icon color */
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%; /* Makes the icon container circular */
            margin-right: 10px;
        }

        .modal-icon i {
            font-size: 1.0rem; /* Adjust the size of the icon */
            display: inline-block !important; /* Make sure it's displayed */
            color: ##f7f7f4 !important;  /* Make the icon white */
            line-height: 1;  /* Ensure no weird alignment */
            vertical-align: middle;  /* Make sure it's aligned correctly */
        
        }

        #queryModal .modal-body {
            background-color: #f7f7f4; /* Same as the modal background color */
            color: #393E41;
        }
    
        #queryModal .modal-body .list-group {
            background-color: #f7f7f4; /* Same background as modal */
            color: #393E41;
        }
    
        #queryModal .modal-body .list-group-item {
            background-color: #f7f7f4; /* Same background as modal */
            border-color: #e06f52;
            color: #393E41;
        }
    
        #queryModal .modal-body .list-group-item:hover {
            background-color: #dededc; /* Lighter gray on hover */
        }

        #queryModal .modal-header .modal-icon i {
            font-size: 1.0rem; /* Adjust the size of the icon */
            display: inline-block !important; /* Make sure it's displayed */
            color: ##f7f7f4 !important;  /* Make the icon white */
            line-height: 1;  /* Ensure no weird alignment */
            vertical-align: middle;  /* Make sure it's aligned correctly */
        }
        .navbar {
            background-color: #f7f7f4; /* Navbar background color */  /* Ensure no top padding in the navbar */
            padding-bottom: 5; /* Remove bottom padding of navbar */
            padding-top: 5;
        }

        /* Set the text and icon color to #f7f7f4 */
        .navbar .navbar-brand, 
        .navbar .nav-link, 
        .navbar-toggler-icon,
        .navbar .nav-item i {
            color:  #d9593a !important; /* Override text and icon color */
        }

    

 
        
    
        
    
        /* Adjust margin between navbar and content */
        body {
            color: #393E41;
            margin-top: 0; /* Remove any default margin at the top */
            font-family: 'Roboto', sans-serif; /* Set the font to Roboto for the whole body */

        }

        /* Adjust the top margin of the first section (Query Menu) */
        #queryMenu {
            margin-top: -10px !important;; /* Reduce space between navbar and section */
        }

        #queryMenu h1 {
            color: #393E41;
            margin-top: 25px; 
            margin-bottom: 20px;/* Add some space between the heading and feature cards */
        }
        .container {
            padding-top: 0; /* Remove top padding from the container */
        }
        .row .col-md-4 {
            margin-bottom: 20px; /* Add space between the cards */
        }
        


        .navbar-toggler-icon {
            background-image: none;
            display: grid;
            grid-template-columns: repeat(3, 7px); /* 3 columns, each 5px */
            grid-template-rows: repeat(3, 7px);    /* 3 rows, each 5px */
            gap: 1px;                               /* Small gap between squares */
            width: 22px;                            /* Overall width of the waffle icon */
            height: 22px;                           /* Overall height of the waffle icon */
            justify-content: center;                /* Center grid horizontally */
            align-items: center;                    /* Center grid vertically */
        }

        /* Individual waffle squares (bars) */
        .navbar-toggler-icon span {
            display: block;
            background-color: #d9593a; /* Waffle square color */
            border-radius: 0px; 
            border-color:  #d9593a; /* Slightly rounded corners */
        }

        /* Square size adjustments */
        .navbar-toggler-icon span {
            height: 6px; /* Height of each square */
            width: 6px;  /* Width of each square */
        }

        /* Toggle button appearance */
        .navbar-toggler {
            padding: 0; /* Remove default padding */
            border: none; /* Remove border */
            display: flex; /* Use flexbox to center the icon */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            width: 30px; /* Total width of the button */
            height: 30px; /* Total height of the button */
            background-color: transparent; /* Transparent background */
            position: relative; /* Allow positioning */
            top: 5px; /* Shift button down slightly */
            left: -5px; /* Shift button left slightly */
        }

        /* Adjust the appearance when the hamburger is clicked */
        .navbar-toggler-icon.collapsed span:nth-child(1) {
            transform: translate(8px, 8px) rotate(45deg); /* Move and rotate the first square */
        }

        .navbar-toggler-icon.collapsed span:nth-child(3) {
            transform: translate(-8px, 8px) rotate(-45deg); /* Move and rotate the third square */
        }

        .navbar-toggler-icon.collapsed span:nth-child(5),
        .navbar-toggler-icon.collapsed span:nth-child(7),
        .navbar-toggler-icon.collapsed span:nth-child(9) {
            opacity: 0; /* Hide the other squares when collapsed */
        }

        /* Hover effect for waffle squares */
        .navbar-toggler-icon:hover span {
            background-color: #f7f7f4; /* Change color on hover */
        }

        /* Hover effect for the toggle button */
        .navbar-toggler:hover {
            background-color: #d9593a; /* Button background change on hover */
        }
        /* Feature Card Container - Grid Layout */
        .feature-card-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 equal-width columns on large screens */
            gap: 20px; /* Space between cards */
            margin-bottom: 20px; /* Space below the grid */
        }
        
        @media (max-width: 992px) {
            .feature-card-container {
                grid-template-columns: repeat(2, 1fr); /* 2 columns on medium screens */
            }
        }
        
        @media (max-width: 768px) {
            .feature-card-container {
                grid-template-columns: 1fr; /* 1 column on small screens */
            }
        }
        
        /* Feature Card Style */
        .feature-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            border: 3px solid #d9593a;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            color: #393E41;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-height: 250px; /* Ensure all cards have a consistent minimum height */
            height: 100%; /* Make sure all cards stretch to the same height */
        }
        
        .feature-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Feature Card Icon */
        .feature-card-icon {
            font-size: 3rem;
            color: #d9593a;
        }
        
        /* Feature Card Title */
        .feature-card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 15px;
            color: #393E41;
        }
        
        /* Feature Card Description */
        .feature-card-description {
            margin-top: 10px;
            font-size: 1rem;
            flex-grow: 1;
            color: #393E41;
        }
        
        /* Adjust the column layout for each card on mobile */
        .feature-card-container .col-md-4 {
            display: block; /* Ensures the card fills the full width on smaller screens */
            margin-bottom: 20px; /* Additional spacing below each card */
            color: #393E41;
        }
                
    
    </style>
</head>
<body style="background-color: #f7f7f4;">

    <!-- Navbar -->

        <!-- Navbar -->
        <nav class="navbar navbar-light" style="background-color:#f7f7f4; padding-top: 1px; padding-bottom: 1px;">
            <div class="container-fluid">
                <!-- Brand or Logo -->
                <a class="navbar-brand" href="#" style="padding-top: 0px; padding-bottom: 0px;">
                </a>
        
                <!-- Toggle Button for Mobile and Desktop View (always visible) -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon">
                        <!-- 9 Squares for Waffle Icon -->
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </button>
                
                <!-- Navbar Links (Hidden by default, shown on toggle) -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <!-- Query Menu Link -->
                        <!-- Query Menu Link -->
                        <li class="nav-item">
                            <a class="nav-link" a href="{{ url_for('home') }}">
                                <i class="bi bi-house-door"></i> Home
                            </a>
                        </li>
    
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('features') }}">
                                <i class="bi bi-search"></i> Query Menu
                            </a>
                        </li>
                        <!-- Tables Link -->
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('tables') }}">
                                <i class="bi bi-table"></i> Tables
                            </a>
                        </li>
                        <!-- About Link -->
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('about') }}">
                                <i class="bi bi-info-circle"></i> About
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('add_data') }}">
                                <i class="bi bi-file-earmark-plus"></i> Add Data
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
                    
        <!-- Query Menu Section -->
        <section id="queryMenu" class="container my-5">
            <h1 class="text-center">Query Menu</h1>
    
            <div class="row mt-5">
    
                <!-- Query Card 1 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_1', 'Fall Beverage and Pastry Pairings', 'bi-cup-hot')">
                        <div class="feature-card-icon">
                            <i class="bi bi-cup-hot"></i> 
                        </div>
                        <div class="feature-card-title">Fall Beverage and Pastry Pairings</div>
                        <div class="feature-card-description">Fall beverage and pastry pairings with their discounted combination price</div>
                    </div>
                </div>
    
                <!-- Query Card 2 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_2', 'Popular Breakfast Items', 'bi-egg-fried')">
                        <div class="feature-card-icon">
                            <i class="bi bi-egg-fried"></i> <!-- Correct icon -->
                        </div>
                        <div class="feature-card-title">Popular Breakfast Items</div>
                        <div class="feature-card-description">Most popular menu items in the breakfast category, sorted by amount sold</div>
                    </div>
                </div>
    
                <!-- Query Card 3 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_3', 'Annual Sales Difference', 'bi-receipt-cutoff')">
                        <div class="feature-card-icon">
                            <i class="bi bi-receipt-cutoff"></i>
                        </div>
                        <div class="feature-card-title">Annual Sales Difference</div>
                        <div class="feature-card-description">Print the difference between annual sales in 2022 and 2023 in USD </div>
                    </div>
                </div>
    
                <!-- Query Card 4 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_4','Star Employees' ,'bi-star')">
                        <div class="feature-card-icon">
                            <i class="bi bi-star"></i>
                        </div>
                        <div class="feature-card-title">Star Employees</div>
                        <div class="feature-card-description">List employees by name and by their total sales (in USD), in order of total sales</div>
                    </div>
                </div>
    
                <!-- Query Card 5 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_5', 'Popular Book Genres','bi-bookmark-heart')">
                        <div class="feature-card-icon">
                            <i class="bi bi-bookmark-heart"></i>
                        </div>
                        <div class="feature-card-title">Popular Book Genres</div>
                        <div class="feature-card-description">List the most popular book genres in the inventory, in order of descreasing item count</div>
                    </div>
                </div>
    
                <!-- Query Card 6 (Fix missing argument in `runQuery`) -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_6', 'Cake Sales', 'bi-cake2')">
                        <div class="feature-card-icon">
                            <i class="bi bi-cake2"></i>
                        </div>
                        <div class="feature-card-title">Cake Sales</div>
                        <div class="feature-card-description">List employees by name and phone number in order of how much cake they have sold</div>
                    </div>
                </div>
    
                <!-- Query Card 7 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="requestYearForQuery7()">
                        <div class="feature-card-icon">
                            <i class="bi bi-chat-right-quote"></i>
                        </div>
                        <div class="feature-card-title">Fantasy Novels Sold</div>
                        <div class="feature-card-description">Display fantasy novels sold in a user-provided year between 2018 and 2024, with 2024 as the default</div>
                    </div>
                </div>
    
                <!-- Query Card 8 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_8', 'Common Ingredients','bi-clipboard2-heart')">
                        <div class="feature-card-icon">
                            <i class="bi bi-clipboard2-heart"></i>
                        </div>
                        <div class="feature-card-title">Common Ingredients</div>
                        <div class="feature-card-description">Display ingredients in at least 3 menu items by how many items they are in and the price of the most expensive item they are in</div>
                    </div>
                </div>
    
                <!-- Query Card 9 -->
                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_9', 'Frequent Customers' ,'bi-basket')">
                        <div class="feature-card-icon">
                            <i class="bi bi-basket"></i>
                        </div>
                        <div class="feature-card-title">Frequent Customers</div>
                        <div class="feature-card-description">Display loyalty members by name, loyalty number, and number of visits for customers who have visited more than 3 times </div>
                    </div>
                </div>
    
                <!-- Query Card 10 -->
                <div class="col-lg-12 col-md-6 col-12 mb-4">
                    <div class="feature-card flex-grow-1" onclick="runQuery('query_10', 'Menu Items by Category', 'bi-shop')">
                        <div class="feature-card-icon">
                            <i class="bi bi-shop"></i>
                        </div>
                        <div class="feature-card-title">Menu Items by Category</div>
                        <div class="feature-card-description">Displays number of menu items, quantity of menu items sold, and total sales (in USD) by menu category</div>
                    </div>
                </div>
    
            </div>
        </section>

<!-- Modal for Accepting User Input (year) -->
<div class="modal fade" id="yearInputModal" tabindex="-1" aria-labelledby="yearInputModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="yearInputModalLabel" style="flex-grow: 1;">Select Year for Fantasy Books</h5>
                <div id="queryModalIcon" class="modal-icon">
                    <i class="bi"></i> <!-- Icon will be added dynamically -->    
                </div>

                <button type="button" class="btn-close"onclick="closeModal()"  data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="yearInputForm" onsubmit="handleYearSubmit(event)">
                    <div class="mb-3">
                        <label for="year" class="form-label">Enter Year</label>
                        <input type="number" class="form-control" id="year" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>






<!-- Modal for displaying query results -->
<div class="modal fade" id="queryModal" tabindex="-1" aria-labelledby="queryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" id="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="queryModalLabel" style="flex-grow: 1;"></h5>
                <div id="queryModalIcon" class="modal-icon">
                    <i class="bi"></i> <!-- Icon will be added dynamically -->
                </div>
                <!-- Close button -->
                <button type="button" class="btn-close" onclick="closeModal()" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Query results will go here -->
                <div class="loading">
                    <p>Loading...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Go Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>


<script>
    // Global metadata for queries
    const queryMetadata = {
        'query_1': { title: 'Fall Beverage Pairings', icon: 'bi-cup-hot' },
        'query_2': { title: 'Popular Breakfast Items', icon: 'bi-egg-fried' },
        'query_3': { title: 'Annual Sales Difference', icon: 'bi-receipt-cutoff' },
        'query_4': { title: 'Star Employees', icon: 'bi-star' },
        'query_5': { title: 'Popular Book Genres', icon: 'bi-bookmark-heart' },
        'query_6': { title: 'Cake Sales', icon: 'bi-cake2' },
        'query_7': { title: 'Fantasy Novels', icon: 'bi-chat-right-quote' },
        'query_8': { title: 'Menu Items', icon: 'bi-bi-clipboard2-heart' },
        'query_9': { title: 'Frequent Customers', icon: 'bi-basket' },
        'query_10': { title: 'Menu Items by Category', icon: 'bi-shop' }
    };

        // Function to update the icon for the modal
    function updateIconForModal(modalId, iconClass) {
        const modalIcon = document.getElementById(modalId).querySelector('.modal-icon i');
        
        // Remove any previous icon class to avoid conflicts
        modalIcon.classList.remove(...modalIcon.classList);

        // Add the correct Bootstrap icon class
        modalIcon.classList.add('bi', iconClass);
}

        
        // Function to request the year for query 7 (Fantasy Novels)
        
        // Function to run query without year (for other queries)
    function runQuery(queryType, title, icon) {
        console.log('runQuery function called with:', queryType, title, icon); // Debugging log
    
        const metadata = queryMetadata[queryType];
        const modalTitle = document.getElementById('queryModalLabel');
        const modalIcon = document.getElementById('queryModalIcon');
    
        // Set the title either from passed value or from metadata
        modalTitle.textContent = title || metadata.title;
    
        // Update the icon based on metadata for this query type
        updateIconForModal('queryModal', icon || metadata.icon);  // Dynamically update the icon
        
        const modalBody = document.getElementById('modalBody');
        modalBody.innerHTML = ''; // Clear any existing content
    
        // Fetch query data
        fetch(`/run_query/${queryType}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    modalBody.innerHTML = `<p>Error: ${data.error}</p>`;
                } else {
                    let html = '';
                    if (Array.isArray(data)) {
                        if (data.length && typeof data[0] === 'object' && Object.keys(data[0]).length > 1) {
                            html += '<table class="table table-striped"><thead><tr>';
                            Object.keys(data[0]).forEach(column => {
                                html += `<th>${column}</th>`;
                            });
                            html += '</tr></thead><tbody>';
                            data.forEach(row => {
                                html += '<tr>';
                                Object.values(row).forEach(cell => {
                                    html += `<td>${cell !== null && cell !== undefined ? cell : ''}</td>`;
                                });
                                html += '</tr>';
                            });
                            html += '</tbody></table>';
                        } else {
                            html += '<ul class="list-group list-group-flush custom-list-group">';
                            data.forEach(row => {
                                const item = row[Object.keys(row)[0]] || "Unknown Item";
                                html += `<li class="list-group-item">${item}</li>`;
                            });
                            html += '</ul>';
                        }
                    } else {
                        html += `<p>${data}</p>`;
                    }
    
                    modalBody.innerHTML = html;
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                document.getElementById('modalBody').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            });
    
        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('queryModal'));
        modal.show();
    }
        
    function requestYearForQuery7() {
        const metadata = queryMetadata['query_7']; // Get the metadata for query_7
        const modal = new bootstrap.Modal(document.getElementById('yearInputModal')); // Show the year input modal
        modal.show();
        
        // Reset the modal title and icon for Fantasy Novels
        const yearModalTitle = document.getElementById('yearInputModalLabel');
        yearModalTitle.textContent = metadata.title;  // Ensure correct title
    
        const yearModalIcon = document.getElementById('queryModalIcon').querySelector('i');
        yearModalIcon.className = 'bi ' + metadata.icon; // Set correct icon for Fantasy Novels
    }

                
        // Handle year form submission for Fantasy Novels
// Handle year form submission for Fantasy Novels
    function handleYearSubmit(event) {
        event.preventDefault(); // Prevent form submission from reloading the page

        const yearInput = document.getElementById('year').value; // Get the year input
        let year = parseInt(yearInput);

        if (isNaN(year) || year < 2018 || year > 2024) {
            alert("Sorry! You must enter a year between 2018 and 2024. Using default year 2024.");
            year = 2024;  // Default year if invalid input
        }

        // Close the modal after submitting the year
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('yearInputModal'));
        modalInstance.hide();

        // Call the function to run the query with the selected year and icon
        runQueryWithYear('query_7', year, 'bi-chat-right-quote');  // Pass the icon here as well
    }

        
    
        // Function to run query with year (for query 7)
    // Function to run query with year (for query 7)
    function runQueryWithYear(queryType, year, icon) {
        const metadata = queryMetadata[queryType];
        const modalTitle = document.getElementById('queryModalLabel');
        const modalIcon = document.getElementById('queryModalIcon');  // This line stays

        // Set the modal title from metadata
        modalTitle.textContent = metadata.title;

        // Update the icon based on metadata for this query type
        updateIconForModal('queryModal', icon || metadata.icon);  // Dynamically update the icon


        const modalBody = document.getElementById('modalBody');
        modalBody.innerHTML = ''; // Clear any existing content

        // Fetch query data
        fetch(`/run_query/${queryType}?year=${year}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    modalBody.innerHTML = `<p>Error: ${data.error}</p>`;
                } else {
                    let html = '';
                    if (Array.isArray(data)) {
                        if (data.length && typeof data[0] === 'object' && Object.keys(data[0]).length > 1) {
                            html += '<table class="table table-striped"><thead><tr>';
                            Object.keys(data[0]).forEach(column => {
                                html += `<th>${column}</th>`;
                            });
                            html += '</tr></thead><tbody>';
                            data.forEach(row => {
                                html += '<tr>';
                                Object.values(row).forEach(cell => {
                                    html += `<td>${cell !== null && cell !== undefined ? cell : ''}</td>`;
                                });
                                html += '</tr>';
                            });
                            html += '</tbody></table>';
                        } else {
                            html += '<ul class="list-group list-group-flush custom-list-group">';
                            data.forEach(row => {
                                const item = row[Object.keys(row)[0]] || "Unknown Item";
                                html += `<li class="list-group-item">${item}</li>`;
                            });
                            html += '</ul>';
                        }
                    } else {
                        html += `<p>${data}</p>`;
                    }

                    modalBody.innerHTML = html;
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                document.getElementById('modalBody').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            });

        // Show the query modal
        const modal = new bootstrap.Modal(document.getElementById('queryModal'));
        modal.show();  // Ensure this opens after the year modal closes
    }
            



</script>


</body>
</html>


