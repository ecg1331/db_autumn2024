<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HP Coffee Queries</title>
    <!-- Bootstrap CSS (from CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons CSS (from CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    
    <style>

        .modal-content {
            background-color: #f7f7f4; /* Light gray background */
            border-radius: 8px;
        }
    
        /* Change the modal header background color */
        .modal-header {
            background-color: #f7f7f7; 
            display: flex; /* Enable flexbox */
            justify-content: space-between; /* Space between title and icon */
            align-items: center; /* Align vertically */
            border-color: #e78f79;
            font-weight: bold;
        
        }
    
        .custom-list-group {
            background-color: #f7f7f4; 
        }

        .h1 {
            font-weight: bold;
        }
        .custom-list-group .list-group-item:hover {
            background-color: #dededc; 
        }

        /* Change the modal footer background color */
        .modal-footer {
            background-color: #f7f7f7; /* Light gray footer */
            border-color: #e78f79;
        }
    
        /* Change the modal overlay (background color when modal is open) */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7); /* Darker backdrop */
        }
    
        .modal-border {
            color: #e06f52
        }
    
        .btn-primary {
            background-color: #dc5f3f; /* Custom color for primary button */
            border: none;
        }
    
        .btn-primary:hover {
            background-color: #c65639; /* Darker shade on hover */
        }
        
        .feature-card {
            border: 1.5px solid #d9593a;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .feature-card-icon {
            font-size: 3rem;
            color: #d9593a;  /* Change this to your desired hex color */
        }

        .feature-card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 15px;
        }
        

        .feature-card-description {
            margin-top: 10px;
            font-size: 1rem;
        }

        .feature-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
        }

        /* Ensure responsiveness */
        .feature-card-container .col-md-4 {
            flex: 1 0 30%; /* 3 items per row on medium screens */
            min-width: 250px; /* Ensures the cards shrink on smaller screens */
        }

        @media (max-width: 768px) {
            .feature-card-container .col-md-4 {
                flex: 1 0 45%; /* 2 items per row on smaller screens */
            }
        }

        @media (max-width: 480px) {
            .feature-card-container .col-md-4 {
                flex: 1 0 100%; /* 1 item per row on extra small screens */
            }
        }

        #queryModalLabel {
            margin-right: 10px; /* Adds space between title and icon */
            font-weight: bold;
            
        }

        #yearInputModalLabel {
            margin-right: 10px; /* Adds space between title and icon */
            font-weight: bold;
            
        }

        .modal-icon {
            width: 30px; /* Size of the icon container */
            height: 30px; /* Size of the icon container */
            background-color: #d9593a; /* Background color of the icon */
            color: #f7f7f4; /* Icon color */
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%; /* Makes the icon container circular */
            margin-right: 10px;
        }

        .modal-icon i {
            font-size: 1.0rem; /* Adjust the size of the icon */
            display: inline-block !important; /* Make sure it's displayed */
            color: ##f7f7f4 !important;  /* Make the icon white */
            line-height: 1;  /* Ensure no weird alignment */
            vertical-align: middle;  /* Make sure it's aligned correctly */
        
        }

        #queryModal .modal-body {
            background-color: #f7f7f4; /* Same as the modal background color */
        }
    
        #queryModal .modal-body .list-group {
            background-color: #f7f7f4; /* Same background as modal */
        }
    
        #queryModal .modal-body .list-group-item {
            background-color: #f7f7f4; /* Same background as modal */
            border-color: #e06f52;
        }
    
        #queryModal .modal-body .list-group-item:hover {
            background-color: #dededc; /* Lighter gray on hover */
        }

        #queryModal .modal-header .modal-icon i {
            font-size: 1.0rem; /* Adjust the size of the icon */
            display: inline-block !important; /* Make sure it's displayed */
            color: ##f7f7f4 !important;  /* Make the icon white */
            line-height: 1;  /* Ensure no weird alignment */
            vertical-align: middle;  /* Make sure it's aligned correctly */
        }
        

    </style>
</head>
<body style="background-color: #f7f7f4;">


<div class="container mt-5">
    <h1 class="text-center">Query Menu</h1>

    <div class="feature-card-container">

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_1', 'Seasonal Beverage Pairings', 'bi-cup-hot')">
                <div class="feature-card-icon">
                    <i class="bi bi-cup-hot"></i> 
                </div>
                <div class="feature-card-title">Seasonal Beverage and Pastry Pairings</div>
                <div class="feature-card-description">Seasonal beverage and pastry pairings with their discounted combination price</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_2', 'Popular Breakfast Items', 'bi-egg-fried')">
                <div class="feature-card-icon">
                    <i class="bi bi-egg-fried"></i> <!-- Correct icon -->
                </div>
                <div class="feature-card-title">Popular Breakfast Items</div>
                <div class="feature-card-description">Most popular menu items in the breakfast category, sorted by amount sold</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_3', 'Annual Sales Difference', 'bi-receipt-cutoff')">
                <div class="feature-card-icon">
                    <i class="bi bi-receipt-cutoff"></i>
                </div>
                <div class="feature-card-title">Annual Sales Difference</div>
                <div class="feature-card-description">Finding the difference between sales in 2022 and 2023 (USD) </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_4','Star Employees' ,'bi-star')">
                <div class="feature-card-icon">
                    <i class="bi bi-star"></i>
                </div>
                <div class="feature-card-title">Star Employees</div>
                <div class="feature-card-description">Employees by name high performing</div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_5', 'Popular Book Genres','bi-bookmark-heart')">
                <div class="feature-card-icon">
                    <i class="bi bi-bookmark-heart"></i>
                </div>
                <div class="feature-card-title">Popular Book Genres</div>
                <div class="feature-card-description">Most popular book genres (by descending item count)</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_6', , 'bi-cake2')">
                <div class="feature-card-icon">
                    <i class="bi bi-cake2"></i>
                </div>
                <div class="feature-card-title">Feature 6</div>
                <div class="feature-card-description">Description of Feature 6.</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="requestYearForQuery7()">
                <div class="feature-card-icon">
                    <i class="bi bi-chat-right-quote"></i>
                </div>
                <div class="feature-card-title">Fantasy Novels Sold</div>
                <div class="feature-card-description">Display fantasy novels sold (by title) in a user-provided between 2018 and 2024, with 2024 as the default</div>
            </div>
        </div>
        

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_8', 'feature 8','bi-gift')">
                <div class="feature-card-icon">
                    <i class="bi bi-gift"></i>
                </div>
                <div class="feature-card-title">Feature 8</div>
                <div class="feature-card-description">Description of Feature 8.</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_9', 'Frequent Customers' ,'bi-basket')">
                <div class="feature-card-icon">
                    <i class="bi bi-basket"></i>
                </div>
                <div class="feature-card-title">Frequent Customers</div>
                <div class="feature-card-description">Display customer loyalty members who have visited more than 3 times </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="feature-card" onclick="runQuery('query_10', , 'bi-shop')">
                <div class="feature-card-icon">
                    <i class="bi bi-shop"></i>
                </div>
                <div class="feature-card-title">Feature 10</div>
                <div class="feature-card-description">Description of Feature 10.</div>
            </div>
        </div>


    </div>
</div>
<!-- Modal for Accepting User Input (year) -->
<div class="modal fade" id="yearInputModal" tabindex="-1" aria-labelledby="yearInputModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="yearInputModalLabel" style="flex-grow: 1;">Select Year for Fantasy Books</h5>
                <div id="queryModalIcon" class="modal-icon">
                    <i class="bi"></i> <!-- Icon will be added dynamically -->    
                </div>

                <button type="button" class="btn-close"onclick="closeModal()"  data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="yearInputForm" onsubmit="handleYearSubmit(event)">
                    <div class="mb-3">
                        <label for="year" class="form-label">Enter Year</label>
                        <input type="number" class="form-control" id="year" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal for displaying query results -->
<div class="modal fade" id="queryModal" tabindex="-1" aria-labelledby="queryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" id="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="queryModalLabel" style="flex-grow: 1;"></h5>
                <div id="queryModalIcon" class="modal-icon">
                    <i class="bi"></i> <!-- Icon will be added dynamically -->
                </div>
                <!-- Close button -->
                <button type="button" class="btn-close" onclick="closeModal()" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Query results will go here -->
                <div class="loading">
                    <p>Loading...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Go Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

<script>
    // Global metadata for queries
    const queryMetadata = {
        'query_1': { title: 'Seasonal Beverage Pairings', icon: 'bi-cup-hot' },
        'query_2': { title: 'Popular Breakfast Items', icon: 'bi-egg-fried' },
        'query_3': { title: 'Annual Sales Difference', icon: 'bi-receipt-cutoff' },
        'query_4': { title: 'Star Employees', icon: 'bi-star' },
        'query_5': { title: 'Popular Book Genres', icon: 'bi-bookmark-heart' },
        'query_6': { title: 'Feature 6 Title', icon: 'bi-cake2' },
        'query_7': { title: 'Fantasy Novels', icon: 'bi-chat-right-quote' },
        'query_8': { title: 'Feature 8 Title', icon: 'bi-gift' },
        'query_9': { title: 'Frequent Customers', icon: 'bi-basket' },
        'query_10': { title: 'Feature 10 Title', icon: 'bi-shop' }
    };

        // Function to update the icon for the modal
    function updateIconForModal(modalId, iconClass) {
        const modalIcon = document.getElementById(modalId).querySelector('.modal-icon i');
        
        // Remove any previous icon class to avoid conflicts
        modalIcon.classList.remove(...modalIcon.classList);

        // Add the correct Bootstrap icon class
        modalIcon.classList.add('bi', iconClass);
}

        
        // Function to request the year for query 7 (Fantasy Novels)
        
        // Function to run query without year (for other queries)
        function runQuery(queryType, title, icon) {
            console.log('runQuery function called with:', queryType, title, icon); // Debugging log
        
            const metadata = queryMetadata[queryType];
            const modalTitle = document.getElementById('queryModalLabel');
            const modalIcon = document.getElementById('queryModalIcon');
        
            // Set the title either from passed value or from metadata
            modalTitle.textContent = title || metadata.title;
        
            // Update the icon based on metadata for this query type
            updateIconForModal('queryModal', icon || metadata.icon);  // Dynamically update the icon
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = ''; // Clear any existing content
        
            // Fetch query data
            fetch(`/run_query/${queryType}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        modalBody.innerHTML = `<p>Error: ${data.error}</p>`;
                    } else {
                        let html = '';
                        if (Array.isArray(data)) {
                            if (data.length && typeof data[0] === 'object' && Object.keys(data[0]).length > 1) {
                                html += '<table class="table table-striped"><thead><tr>';
                                Object.keys(data[0]).forEach(column => {
                                    html += `<th>${column}</th>`;
                                });
                                html += '</tr></thead><tbody>';
                                data.forEach(row => {
                                    html += '<tr>';
                                    Object.values(row).forEach(cell => {
                                        html += `<td>${cell !== null && cell !== undefined ? cell : ''}</td>`;
                                    });
                                    html += '</tr>';
                                });
                                html += '</tbody></table>';
                            } else {
                                html += '<ul class="list-group list-group-flush custom-list-group">';
                                data.forEach(row => {
                                    const item = row[Object.keys(row)[0]] || "Unknown Item";
                                    html += `<li class="list-group-item">${item}</li>`;
                                });
                                html += '</ul>';
                            }
                        } else {
                            html += `<p>${data}</p>`;
                        }
        
                        modalBody.innerHTML = html;
                    }
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    document.getElementById('modalBody').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
                });
        
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('queryModal'));
            modal.show();
        }
        
        function requestYearForQuery7() {
            const metadata = queryMetadata['query_7']; // Get the metadata for query_7
            const modal = new bootstrap.Modal(document.getElementById('yearInputModal')); // Show the year input modal
            modal.show();
            
            // Reset the modal title and icon for Fantasy Novels
            const yearModalTitle = document.getElementById('yearInputModalLabel');
            yearModalTitle.textContent = metadata.title;  // Ensure correct title
        
            const yearModalIcon = document.getElementById('queryModalIcon').querySelector('i');
            yearModalIcon.className = 'bi ' + metadata.icon; // Set correct icon for Fantasy Novels
        }
                
        // Handle year form submission for Fantasy Novels
// Handle year form submission for Fantasy Novels
    function handleYearSubmit(event) {
        event.preventDefault(); // Prevent form submission from reloading the page

        const yearInput = document.getElementById('year').value; // Get the year input
        let year = parseInt(yearInput);

        if (isNaN(year) || year < 2018 || year > 2024) {
            alert("Sorry! You must enter a year between 2018 and 2024. Using default year 2024.");
            year = 2024;  // Default year if invalid input
        }

        // Close the modal after submitting the year
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('yearInputModal'));
        modalInstance.hide();

        // Call the function to run the query with the selected year and icon
        runQueryWithYear('query_7', year, 'bi-chat-right-quote');  // Pass the icon here as well
    }
                
        // Function to run query with year (for query 7)
    // Function to run query with year (for query 7)
    function runQueryWithYear(queryType, year, icon) {
        const metadata = queryMetadata[queryType];
        const modalTitle = document.getElementById('queryModalLabel');
        const modalIcon = document.getElementById('queryModalIcon');  // This line stays

        // Set the modal title from metadata
        modalTitle.textContent = metadata.title;

        // Update the icon based on metadata for this query type
        updateIconForModal('queryModal', icon || metadata.icon);  // Dynamically update the icon


        const modalBody = document.getElementById('modalBody');
        modalBody.innerHTML = ''; // Clear any existing content

        // Fetch query data
        fetch(`/run_query/${queryType}?year=${year}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    modalBody.innerHTML = `<p>Error: ${data.error}</p>`;
                } else {
                    let html = '';
                    if (Array.isArray(data)) {
                        if (data.length && typeof data[0] === 'object' && Object.keys(data[0]).length > 1) {
                            html += '<table class="table table-striped"><thead><tr>';
                            Object.keys(data[0]).forEach(column => {
                                html += `<th>${column}</th>`;
                            });
                            html += '</tr></thead><tbody>';
                            data.forEach(row => {
                                html += '<tr>';
                                Object.values(row).forEach(cell => {
                                    html += `<td>${cell !== null && cell !== undefined ? cell : ''}</td>`;
                                });
                                html += '</tr>';
                            });
                            html += '</tbody></table>';
                        } else {
                            html += '<ul class="list-group list-group-flush custom-list-group">';
                            data.forEach(row => {
                                const item = row[Object.keys(row)[0]] || "Unknown Item";
                                html += `<li class="list-group-item">${item}</li>`;
                            });
                            html += '</ul>';
                        }
                    } else {
                        html += `<p>${data}</p>`;
                    }

                    modalBody.innerHTML = html;
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                document.getElementById('modalBody').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            });

        // Show the query modal
        const modal = new bootstrap.Modal(document.getElementById('queryModal'));
        modal.show();  // Ensure this opens after the year modal closes
    }
            
</script>


</body>
</html>


